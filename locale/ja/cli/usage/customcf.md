---
title: カスタムCloudFormationスタック数
description: Amplify CLI は、CLI によって CloudFormation テンプレートの形式で生成されたバックエンド構成を変更するためのエスケープハッチを提供します。 これにより、CLI を一般的なフローに使用できますが、標準のカテゴリ ワークフローで提供されていない高度なシナリオも使用できます。
---

Amplify CLI は、CLI によって CloudFormation テンプレートの形式で生成されたバックエンド構成を変更するためのエスケープハッチを提供します。 これにより、CLI を一般的なフローに使用できますが、標準のカテゴリ ワークフローで提供されていない高度なシナリオも使用できます。

* Amplify CLI によって生成されたGraphQL API の場合 リゾルバを [オーバーライド](~/cli/graphql-transformer/resolvers.md#overwriting-resolvers) し、独自の [カスタムリゾルバ](~/cli/graphql-transformer/resolvers.md#custom-resolvers) を追加してCLIが生成するCloudFormationスタックに追加することができます。

* For majority of the other categories, you can locally edit and manage the CloudFormation file generated by the CLI in the `amplify/backend/<category>/<cloudformation-template.json/yml>` location. [Read more about Cloudformation](https://aws.amazon.com/cloudformation/)

* 現在Amplify CLIでサポートされていないAWSサービスのCloudFormationスタックを追加およびデプロイするには、次の手順を実行します。

1. プロジェクトの `amplify/backend/backend-config.json` を変更します。
```
{
  "<custom-category-name>": {
    "<custom-resource-name>": {
      "service": <custom-aws-service-name>,
      "providerPlugin": "awscloudformation"
    }
  },
  "hosting": {
    "S3AndCloudFront": {
      "service": "S3AndCloudFront",
      "providerPlugin": "awscloudformation"
    }
  }
}
```

Note: You can also reference an output value from any other Amplify managed category cloudformation stack. For example, if you want to use the Amazon Cognito `userpool ID` generated by the `auth` category stack in your custom cloudformation stack, you would need to add the `dependsOn` block in the `backend-config.json` file, The above `backend-config.json` file would look like the following:

```javascript
{
  "<custom-category-name>": {
    "<custom-resource-name>": {
      "service": <custom-aws-service-name>,
      "providerPlugin": "awscloudformation",
      "dependsOn": [
    {
         "category": "auth",
     "resourceName": "mycognitoresource", // check `amplify status` to find resource name
     "attributes": [
        "UserPoolId" // Check Output Value of the resource specific cloudformation file to find available attributes
      ]
    }
     ]
    }
  },
  "hosting": {
    "S3AndCloudFront": {
      "service": "S3AndCloudFront",
      "providerPlugin": "awscloudformation"
    }
  }
}
```

2. `anplify/backend` フォルダの下に、以下のようなフォルダ構造を作成します:
  ```
  amplify
    \backend
      \<custom-category-name>
        \<custom-resource-name>
          parameters.json
          template.json
      \hosting
        parameters.json
        template.json
  ```
  `template.json` is a cloudformation template, and `parameters.json` is a json file of parameters that will be passed to the cloudformation template. Additionally, the `env` parameter will be passed in to your cloudformation templates dynamically by the CLI. Note: If you have multiple resources in the same category, the cloudformation template files names must be unique but still contain `template`. For example: `template_<your_resource>.json` or `<your_resource>_template.yaml`.

3. To use the above mentioned attribute `UserPoolId` from the auth category in your custom cloudformation stack, you would need to construct the following input parameter in the `template.json` file. The CLI will be passing this input automatically from the other nested stack.

```javascript
"Parameters": {
  // Rest of the parameters

  "authmycognitoresourceUserPoolId": { // The format out here is `<category><resource-name><attribute-name>` - we have defined all of these in the `backend-config.json` file above
     "Type": "String"
 }
},
```

4. パラメータ `に1つのパラメータを配置します。 son <code> という名前の` は `authmycognitoresourceUserPoolId` と cloudforming `Fn::GetAtt` を持ち、ネストされたテンプレートの出力をカスタムテンプレートに接続します。

  ```
    {
           "authmycognitoresourceUserPoolId": {  // The format out here is `<category><resource-name><attribute-name>` - we have defined all of these in the `backend-config.json` file above
              "Fn::GetAtt": [
                 "authmycognitoresource",  // check `amplify status` to find resource name in the category auth
                 "Outputs.UserPoolId"
              ]
           }
    }
  ```

5. `amplify env checkout <current-env-name>` を実行して、CLI ランタイムファイルを生成し、新しく追加されたカスタムリソースを認識させます。
